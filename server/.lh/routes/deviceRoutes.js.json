{
    "sourceFile": "routes/deviceRoutes.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 28,
            "patches": [
                {
                    "date": 1753930369631,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1754034606995,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n const express = require('express');\r\n const router = express.Router();\r\n const deviceController = require('../controllers/deviceController');\r\n \r\n-// localhost:4000/api/devices\r\n-router.get('/devices', deviceController.getAllDevices);\r\n+// รับ GET /api/devices\r\n+router.get('/', deviceController.getAllDevices);\r\n \r\n module.exports = router;\r\n"
                },
                {
                    "date": 1754274152377,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,15 @@\n const express = require('express');\r\n const router = express.Router();\r\n const deviceController = require('../controllers/deviceController');\r\n+const verifyToken = require('../middleware/verifyToken');\r\n \r\n // รับ GET /api/devices\r\n router.get('/', deviceController.getAllDevices);\r\n \r\n-module.exports = router;\r\n+// PUT แก้ไขอุปกรณ์\r\n+router.put('/:id', verifyToken, deviceController.updateDevice);\r\n+\r\n+// DELETE ลบอุปกรณ์\r\n+router.delete('/:id', verifyToken, deviceController.deleteDevice);\r\n+\r\n+module.exports = router;\n\\ No newline at end of file\n"
                },
                {
                    "date": 1754274303475,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,15 +1,29 @@\n const express = require('express');\r\n+const jwt = require('jsonwebtoken');\r\n const router = express.Router();\r\n const deviceController = require('../controllers/deviceController');\r\n-const verifyToken = require('../middleware/verifyToken');\r\n \r\n-// รับ GET /api/devices\r\n-router.get('/', deviceController.getAllDevices);\r\n+// verifyToken middleware ที่ฝังไว้ตรงนี้เลย\r\n+const verifyToken = (req, res, next) => {\r\n+  const authHeader = req.headers.authorization;\r\n+  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n+    return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n+  }\r\n \r\n\\ No newline at end of file\n-// PUT แก้ไขอุปกรณ์\r\n-router.put('/:id', verifyToken, deviceController.updateDevice);\r\n+  const token = authHeader.split(' ')[1];\r\n \r\n-// DELETE ลบอุปกรณ์\r\n-router.delete('/:id', verifyToken, deviceController.deleteDevice);\r\n+  try {\r\n+    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n+    req.user = decoded;\r\n+    next();\r\n+  } catch (err) {\r\n+    return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n+  }\r\n+};\r\n \r\n-module.exports = router;\n+// Routes\r\n+router.get('/', deviceController.getAllDevices); // public\r\n+router.put('/:id', verifyToken, deviceController.updateDevice); // protected\r\n+router.delete('/:id', verifyToken, deviceController.deleteDevice); // protected\r\n+\r\n+module.exports = router;\r\n"
                },
                {
                    "date": 1754363031941,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,11 @@\n+// deviceRoutes.js\r\n const express = require('express');\r\n const jwt = require('jsonwebtoken');\r\n const router = express.Router();\r\n const deviceController = require('../controllers/deviceController');\r\n \r\n-// verifyToken middleware ที่ฝังไว้ตรงนี้เลย\r\n+// ✅ middleware สำหรับตรวจสอบ token\r\n const verifyToken = (req, res, next) => {\r\n   const authHeader = req.headers.authorization;\r\n   if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n     return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n@@ -13,17 +14,17 @@\n   const token = authHeader.split(' ')[1];\r\n \r\n   try {\r\n     const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n-    req.user = decoded;\r\n+    req.user = decoded; // แนบ user ที่ decode แล้ว\r\n     next();\r\n   } catch (err) {\r\n     return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n   }\r\n };\r\n \r\n-// Routes\r\n+// ✅ กำหนด route\r\n router.get('/', deviceController.getAllDevices); // public\r\n router.put('/:id', verifyToken, deviceController.updateDevice); // protected\r\n router.delete('/:id', verifyToken, deviceController.deleteDevice); // protected\r\n\\ No newline at end of file\n \r\n-module.exports = router;\n+module.exports = router;\r\n"
                },
                {
                    "date": 1754366503257,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,11 +1,10 @@\n-// deviceRoutes.js\r\n const express = require('express');\r\n const jwt = require('jsonwebtoken');\r\n const router = express.Router();\r\n const deviceController = require('../controllers/deviceController');\r\n \r\n-// ✅ middleware สำหรับตรวจสอบ token\r\n+// middleware ตรวจสอบ token\r\n const verifyToken = (req, res, next) => {\r\n   const authHeader = req.headers.authorization;\r\n   if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n     return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n@@ -14,17 +13,17 @@\n   const token = authHeader.split(' ')[1];\r\n \r\n   try {\r\n     const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n-    req.user = decoded; // แนบ user ที่ decode แล้ว\r\n+    req.user = decoded; // แนบข้อมูลผู้ใช้ไว้ใน request\r\n     next();\r\n   } catch (err) {\r\n     return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n   }\r\n };\r\n \r\n-// ✅ กำหนด route\r\n+// Routes\r\n router.get('/', deviceController.getAllDevices); // public\r\n router.put('/:id', verifyToken, deviceController.updateDevice); // protected\r\n router.delete('/:id', verifyToken, deviceController.deleteDevice); // protected\r\n\\ No newline at end of file\n \r\n-module.exports = router;\n+module.exports = router;\r\n"
                },
                {
                    "date": 1754377181127,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,9 +21,10 @@\n   }\r\n };\r\n \r\n // Routes\r\n-router.get('/', deviceController.getAllDevices); // public\r\n+router.get('/', deviceController.getAllDevices);                 // public\r\n+router.post('/', verifyToken, deviceController.addDevice);      // protected\r\n router.put('/:id', verifyToken, deviceController.updateDevice); // protected\r\n router.delete('/:id', verifyToken, deviceController.deleteDevice); // protected\r\n\\ No newline at end of file\n \r\n-module.exports = router;\n+module.exports = router;\r\n"
                },
                {
                    "date": 1754411323698,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,30 @@\n+const express = require('express');\r\n+const jwt = require('jsonwebtoken');\r\n+const router = express.Router();\r\n+const deviceController = require('../controllers/deviceController');\r\n+\r\n+// middleware ตรวจสอบ token\r\n+const verifyToken = (req, res, next) => {\r\n+  const authHeader = req.headers.authorization;\r\n+  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n+    return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n+  }\r\n+\r\n+  const token = authHeader.split(' ')[1];\r\n+\r\n+  try {\r\n+    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n+    req.user = decoded;\r\n+    next();\r\n+  } catch (err) {\r\n+    return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n+  }\r\n+};\r\n+\r\n+// Routes\r\n+router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n+router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected (ใช้ชื่อฟังก์ชันที่ถูกต้องแล้ว)\r\n+router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n+router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n+\r\n+module.exports = router;\r\n"
                },
                {
                    "date": 1754636032989,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,33 @@\n+const express = require('express');\r\n+const jwt = require('jsonwebtoken');\r\n+const router = express.Router();\r\n+const deviceController = require('../controllers/deviceController');\r\n+\r\n+// middleware ตรวจสอบ token\r\n+const verifyToken = (req, res, next) => {\r\n+  const authHeader = req.headers.authorization;\r\n+  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n+    return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n+  }\r\n+\r\n+  const token = authHeader.split(' ')[1];\r\n+\r\n+  try {\r\n+    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n+    req.user = decoded;\r\n+    next();\r\n+  } catch (err) {\r\n+    return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n+  }\r\n+};\r\n+\r\n+// Routes\r\n+// Routes\r\n+router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n+router.get('/with-type-name', deviceController.getDevicesWithTypeName); // ✅ เพิ่มใหม่\r\n+router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected\r\n+router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n+router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n+\r\n+\r\n+module.exports = router;\r\n"
                },
                {
                    "date": 1754639860456,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,71 +23,10 @@\n \r\n // Routes\r\n // Routes\r\n router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n-router.get('/with-type-name', deviceController.getDevicesWithTypeName); // ✅ เพิ่มใหม่\r\n+router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected\r\n router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n \r\n-\r\n module.exports = router;\r\n-const express = require('express');\r\n-const jwt = require('jsonwebtoken');\r\n-const router = express.Router();\r\n-const deviceController = require('../controllers/deviceController');\r\n-\r\n-// middleware ตรวจสอบ token\r\n-const verifyToken = (req, res, next) => {\r\n-  const authHeader = req.headers.authorization;\r\n-  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n-    return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n-  }\r\n-\r\n-  const token = authHeader.split(' ')[1];\r\n-\r\n-  try {\r\n-    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n-    req.user = decoded;\r\n-    next();\r\n-  } catch (err) {\r\n-    return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n-  }\r\n-};\r\n-\r\n-// Routes\r\n-router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n-router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected (ใช้ชื่อฟังก์ชันที่ถูกต้องแล้ว)\r\n-router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n-router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n-\r\n-module.exports = router;\r\n-const express = require('express');\r\n-const jwt = require('jsonwebtoken');\r\n-const router = express.Router();\r\n-const deviceController = require('../controllers/deviceController');\r\n-\r\n-// middleware ตรวจสอบ token\r\n-const verifyToken = (req, res, next) => {\r\n-  const authHeader = req.headers.authorization;\r\n-  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n-    return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n-  }\r\n-\r\n-  const token = authHeader.split(' ')[1];\r\n-\r\n-  try {\r\n-    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n-    req.user = decoded; // แนบข้อมูลผู้ใช้ไว้ใน request\r\n-    next();\r\n-  } catch (err) {\r\n-    return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n-  }\r\n-};\r\n-\r\n-// Routes\r\n-router.get('/', deviceController.getAllDevices);                 // public\r\n-router.post('/', verifyToken, deviceController.addDevice);      // protected\r\n-router.put('/:id', verifyToken, deviceController.updateDevice); // protected\r\n-router.delete('/:id', verifyToken, deviceController.deleteDevice); // protected\r\n-\r\n\\ No newline at end of file\n-module.exports = router;\n"
                },
                {
                    "date": 1755057465487,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,33 @@\n+const express = require('express');\r\n+const jwt = require('jsonwebtoken');\r\n+const router = express.Router();\r\n+const deviceController = require('../controllers/deviceController');\r\n+\r\n+// middleware ตรวจสอบ token\r\n+const verifyToken = (req, res, next) => {\r\n+  const authHeader = req.headers.authorization;\r\n+  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n+    return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n+  }\r\n+\r\n+  const token = authHeader.split(' ')[1];\r\n+\r\n+  try {\r\n+    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n+    req.user = decoded;\r\n+    next();\r\n+  } catch (err) {\r\n+    return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n+  }\r\n+};\r\n+\r\n+// Routes\r\n+// Routes\r\n+router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n+router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n+router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected\r\n+router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n+router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n+\r\n+\r\n+module.exports = router;\r\n"
                },
                {
                    "date": 1755057581132,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,39 +27,8 @@\n router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected\r\n router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n+router.get('/brands', deviceController.getAllBrands);\r\n+router.get('/types', deviceController.getAllTypes);\r\n \r\n-\r\n module.exports = router;\r\n-const express = require('express');\r\n-const jwt = require('jsonwebtoken');\r\n-const router = express.Router();\r\n-const deviceController = require('../controllers/deviceController');\r\n-\r\n-// middleware ตรวจสอบ token\r\n-const verifyToken = (req, res, next) => {\r\n-  const authHeader = req.headers.authorization;\r\n-  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n-    return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n-  }\r\n-\r\n-  const token = authHeader.split(' ')[1];\r\n-\r\n-  try {\r\n-    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n-    req.user = decoded;\r\n-    next();\r\n-  } catch (err) {\r\n-    return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n-  }\r\n-};\r\n-\r\n-// Routes\r\n-// Routes\r\n-router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n-router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n-router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected\r\n-router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n-router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n-\r\n-module.exports = router;\r\n"
                },
                {
                    "date": 1755098452026,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,6 +29,7 @@\n router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n router.get('/brands', deviceController.getAllBrands);\r\n router.get('/types', deviceController.getAllTypes);\r\n+router.post('/return-device', returnDevice);\r\n \r\n module.exports = router;\r\n"
                },
                {
                    "date": 1755098457653,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,7 +29,7 @@\n router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n router.get('/brands', deviceController.getAllBrands);\r\n router.get('/types', deviceController.getAllTypes);\r\n-router.post('/return-device', returnDevice);\r\n \r\n+\r\n module.exports = router;\r\n"
                },
                {
                    "date": 1755497639347,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,35 +1,17 @@\n const express = require('express');\r\n-const jwt = require('jsonwebtoken');\r\n const router = express.Router();\r\n const deviceController = require('../controllers/deviceController');\r\n+const upload = require('../controllers/ImageUpload');\r\n \r\n-// middleware ตรวจสอบ token\r\n-const verifyToken = (req, res, next) => {\r\n-  const authHeader = req.headers.authorization;\r\n-  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n-    return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n-  }\r\n-\r\n-  const token = authHeader.split(' ')[1];\r\n-\r\n-  try {\r\n-    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n-    req.user = decoded;\r\n-    next();\r\n-  } catch (err) {\r\n-    return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n-  }\r\n-};\r\n-\r\n-// Routes\r\n-// Routes\r\n-router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n-router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n-router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected\r\n-router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n-router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n+// CRUD devices\r\n+router.get('/', deviceController.getAllDevices);\r\n router.get('/brands', deviceController.getAllBrands);\r\n router.get('/types', deviceController.getAllTypes);\r\n+router.post('/', deviceController.addDevice);\r\n+router.put('/:id', deviceController.updateDevice);\r\n+router.delete('/:id', deviceController.deleteDevice);\r\n \r\n+// --- Route upload image ---\r\n+router.post('/:id/upload-image', upload.single('image'), deviceController.uploadDeviceImage);\r\n \r\n module.exports = router;\r\n"
                },
                {
                    "date": 1755497652629,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,17 +1,36 @@\n const express = require('express');\r\n+const jwt = require('jsonwebtoken');\r\n const router = express.Router();\r\n const deviceController = require('../controllers/deviceController');\r\n-const upload = require('../controllers/ImageUpload');\r\n \r\n-// CRUD devices\r\n-router.get('/', deviceController.getAllDevices);\r\n+// middleware ตรวจสอบ token\r\n+const verifyToken = (req, res, next) => {\r\n+  const authHeader = req.headers.authorization;\r\n+  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n+    return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n+  }\r\n+\r\n+  const token = authHeader.split(' ')[1];\r\n+\r\n+  try {\r\n+    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n+    req.user = decoded;\r\n+    next();\r\n+  } catch (err) {\r\n+    return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n+  }\r\n+};\r\n+\r\n+// Routes\r\n+// Routes\r\n+router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n+router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n+router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected\r\n+router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n+router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n router.get('/brands', deviceController.getAllBrands);\r\n router.get('/types', deviceController.getAllTypes);\r\n-router.post('/', deviceController.addDevice);\r\n-router.put('/:id', deviceController.updateDevice);\r\n-router.delete('/:id', deviceController.deleteDevice);\r\n \r\n-// --- Route upload image ---\r\n-router.post('/:id/upload-image', upload.single('image'), deviceController.uploadDeviceImage);\r\n+router.post('/:id/upload-image', upload.single('image'), deviceController.uploadDeviceImage\r\n \r\n module.exports = router;\r\n"
                },
                {
                    "date": 1755497662858,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,5 +32,5 @@\n router.get('/types', deviceController.getAllTypes);\r\n \r\n router.post('/:id/upload-image', upload.single('image'), deviceController.uploadDeviceImage\r\n \r\n-module.exports = router;\r\n+module.exports = router;\n\\ No newline at end of file\n"
                },
                {
                    "date": 1755497677546,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -30,7 +30,8 @@\n router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n router.get('/brands', deviceController.getAllBrands);\r\n router.get('/types', deviceController.getAllTypes);\r\n \r\n-router.post('/:id/upload-image', upload.single('image'), deviceController.uploadDeviceImage\r\n+router.post('/:id/upload-image', upload.single('image'), deviceController.uploadDeviceImage);\r\n \r\n\\ No newline at end of file\n-module.exports = router;\n+\r\n+module.exports = router;\r\n"
                },
                {
                    "date": 1755498019416,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,9 @@\n const express = require('express');\r\n const jwt = require('jsonwebtoken');\r\n const router = express.Router();\r\n const deviceController = require('../controllers/deviceController');\r\n+const upload = require('../controllers/ImageUpload'); \r\n \r\n // middleware ตรวจสอบ token\r\n const verifyToken = (req, res, next) => {\r\n   const authHeader = req.headers.authorization;\r\n@@ -32,6 +33,5 @@\n router.get('/types', deviceController.getAllTypes);\r\n \r\n router.post('/:id/upload-image', upload.single('image'), deviceController.uploadDeviceImage);\r\n \r\n-\r\n-module.exports = router;\n\\ No newline at end of file\n+module.exports = router;\r\n"
                },
                {
                    "date": 1755498105640,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,37 +1,37 @@\n-const express = require('express');\r\n-const jwt = require('jsonwebtoken');\r\n-const router = express.Router();\r\n-const deviceController = require('../controllers/deviceController');\r\n-const upload = require('../controllers/ImageUpload'); \r\n+// const express = require('express');\r\n+// const jwt = require('jsonwebtoken');\r\n+// const router = express.Router();\r\n+// const deviceController = require('../controllers/deviceController');\r\n+// const upload = require('../controllers/ImageUpload'); \r\n \r\n-// middleware ตรวจสอบ token\r\n-const verifyToken = (req, res, next) => {\r\n-  const authHeader = req.headers.authorization;\r\n-  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n-    return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n-  }\r\n+// // middleware ตรวจสอบ token\r\n+// const verifyToken = (req, res, next) => {\r\n+//   const authHeader = req.headers.authorization;\r\n+//   if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n+//     return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n+//   }\r\n \r\n-  const token = authHeader.split(' ')[1];\r\n+//   const token = authHeader.split(' ')[1];\r\n \r\n-  try {\r\n-    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n-    req.user = decoded;\r\n-    next();\r\n-  } catch (err) {\r\n-    return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n-  }\r\n-};\r\n+//   try {\r\n+//     const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n+//     req.user = decoded;\r\n+//     next();\r\n+//   } catch (err) {\r\n+//     return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n+//   }\r\n+// };\r\n \r\n-// Routes\r\n-// Routes\r\n-router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n-router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n-router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected\r\n-router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n-router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n-router.get('/brands', deviceController.getAllBrands);\r\n-router.get('/types', deviceController.getAllTypes);\r\n+// // Routes\r\n+// // Routes\r\n+// router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n+// router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n+// router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected\r\n+// router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n+// router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n+// router.get('/brands', deviceController.getAllBrands);\r\n+// router.get('/types', deviceController.getAllTypes);\r\n \r\n-router.post('/:id/upload-image', upload.single('image'), deviceController.uploadDeviceImage);\r\n+// router.post('/:id/upload-image', upload.single('image'), deviceController.uploadDeviceImage);\r\n \r\n-module.exports = router;\r\n+// module.exports = router;\r\n"
                },
                {
                    "date": 1755498160416,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,37 +1,35 @@\n-// const express = require('express');\r\n-// const jwt = require('jsonwebtoken');\r\n-// const router = express.Router();\r\n-// const deviceController = require('../controllers/deviceController');\r\n-// const upload = require('../controllers/ImageUpload'); \r\n+const express = require('express');\r\n+const jwt = require('jsonwebtoken');\r\n+const router = express.Router();\r\n+const deviceController = require('../controllers/deviceController');\r\n \r\n-// // middleware ตรวจสอบ token\r\n-// const verifyToken = (req, res, next) => {\r\n-//   const authHeader = req.headers.authorization;\r\n-//   if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n-//     return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n-//   }\r\n+// middleware ตรวจสอบ token\r\n+const verifyToken = (req, res, next) => {\r\n+  const authHeader = req.headers.authorization;\r\n+  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n+    return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n+  }\r\n \r\n-//   const token = authHeader.split(' ')[1];\r\n+  const token = authHeader.split(' ')[1];\r\n \r\n-//   try {\r\n-//     const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n-//     req.user = decoded;\r\n-//     next();\r\n-//   } catch (err) {\r\n-//     return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n-//   }\r\n-// };\r\n+  try {\r\n+    const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n+    req.user = decoded;\r\n+    next();\r\n+  } catch (err) {\r\n+    return res.status(403).json({ message: 'Token หมดอายุหรือล้มเหลว' });\r\n+  }\r\n+};\r\n \r\n-// // Routes\r\n-// // Routes\r\n-// router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n-// router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n-// router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected\r\n-// router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n-// router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n-// router.get('/brands', deviceController.getAllBrands);\r\n-// router.get('/types', deviceController.getAllTypes);\r\n+// Routes\r\n+// Routes\r\n+router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n+router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n+router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected\r\n+router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n+router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n+router.get('/brands', deviceController.getAllBrands);\r\n+router.get('/types', deviceController.getAllTypes);\r\n \r\n-// router.post('/:id/upload-image', upload.single('image'), deviceController.uploadDeviceImage);\r\n \r\n-// module.exports = router;\r\n+module.exports = router;\r\n"
                },
                {
                    "date": 1755498575597,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -30,6 +30,7 @@\n router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n router.get('/brands', deviceController.getAllBrands);\r\n router.get('/types', deviceController.getAllTypes);\r\n \r\n+app.use('/uploads', express.static(path.join(__dirname, 'uploads')));\r\n \r\n module.exports = router;\r\n"
                },
                {
                    "date": 1755498587695,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -30,7 +30,6 @@\n router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n router.get('/brands', deviceController.getAllBrands);\r\n router.get('/types', deviceController.getAllTypes);\r\n \r\n-app.use('/uploads', express.static(path.join(__dirname, 'uploads')));\r\n \r\n module.exports = router;\r\n"
                },
                {
                    "date": 1755498618344,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,9 +21,8 @@\n   }\r\n };\r\n \r\n // Routes\r\n-// Routes\r\n router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected\r\n router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n"
                },
                {
                    "date": 1755498650919,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,6 +29,9 @@\n router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n router.get('/brands', deviceController.getAllBrands);\r\n router.get('/types', deviceController.getAllTypes);\r\n \r\n+router.post('/:id/upload-image', verifyToken, upload.single('image'), deviceController.uploadDeviceImage);\r\n \r\n+\r\n+\r\n module.exports = router;\r\n"
                },
                {
                    "date": 1755498665567,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,9 +29,7 @@\n router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n router.get('/brands', deviceController.getAllBrands);\r\n router.get('/types', deviceController.getAllTypes);\r\n \r\n-router.post('/:id/upload-image', verifyToken, upload.single('image'), deviceController.uploadDeviceImage);\r\n \r\n \r\n-\r\n module.exports = router;\r\n"
                },
                {
                    "date": 1755572621485,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,10 @@\n+// routes/deviceRoutes.js\r\n const express = require('express');\r\n const jwt = require('jsonwebtoken');\r\n const router = express.Router();\r\n const deviceController = require('../controllers/deviceController');\r\n+const upload = require('../controllers/ImageUpload'); // ✅ import multer\r\n \r\n // middleware ตรวจสอบ token\r\n const verifyToken = (req, res, next) => {\r\n   const authHeader = req.headers.authorization;\r\n@@ -10,9 +12,8 @@\n     return res.status(401).json({ message: 'Token ไม่ถูกต้องหรือไม่มี token' });\r\n   }\r\n \r\n   const token = authHeader.split(' ')[1];\r\n-\r\n   try {\r\n     const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n     req.user = decoded;\r\n     next();\r\n@@ -21,15 +22,16 @@\n   }\r\n };\r\n \r\n // Routes\r\n-router.get('/', deviceController.getAllDevices);                     // ✅ public\r\n+router.get('/', deviceController.getAllDevices);\r\n router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n-router.post('/', verifyToken, deviceController.addDevice);          // ✅ protected\r\n-router.put('/:id', verifyToken, deviceController.updateDevice);     // ✅ protected\r\n-router.delete('/:id', verifyToken, deviceController.deleteDevice);  // ✅ protected\r\n+\r\n+// ✅ เพิ่ม upload.single('image')\r\n+router.post('/', verifyToken, upload.single('image'), deviceController.addDevice);\r\n+router.put('/:id', verifyToken, upload.single('image'), deviceController.updateDevice);\r\n+\r\n+router.delete('/:id', verifyToken, deviceController.deleteDevice);\r\n router.get('/brands', deviceController.getAllBrands);\r\n router.get('/types', deviceController.getAllTypes);\r\n \r\n-\r\n-\r\n module.exports = router;\r\n"
                },
                {
                    "date": 1755572705314,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,9 @@\n-// routes/deviceRoutes.js\r\n const express = require('express');\r\n const jwt = require('jsonwebtoken');\r\n const router = express.Router();\r\n const deviceController = require('../controllers/deviceController');\r\n-const upload = require('../controllers/ImageUpload'); // ✅ import multer\r\n+const upload = require('../controllers/ImageUpload'); // import multer\r\n \r\n // middleware ตรวจสอบ token\r\n const verifyToken = (req, res, next) => {\r\n   const authHeader = req.headers.authorization;\r\n@@ -25,9 +24,9 @@\n // Routes\r\n router.get('/', deviceController.getAllDevices);\r\n router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n \r\n-// ✅ เพิ่ม upload.single('image')\r\n+// ✅ รองรับอัปโหลดรูป\r\n router.post('/', verifyToken, upload.single('image'), deviceController.addDevice);\r\n router.put('/:id', verifyToken, upload.single('image'), deviceController.updateDevice);\r\n \r\n router.delete('/:id', verifyToken, deviceController.deleteDevice);\r\n"
                },
                {
                    "date": 1755573243357,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,5 @@\n+// server/routes/deviceRoutes.js\r\n const express = require('express');\r\n const jwt = require('jsonwebtoken');\r\n const router = express.Router();\r\n const deviceController = require('../controllers/deviceController');\r\n@@ -23,14 +24,40 @@\n \r\n // Routes\r\n router.get('/', deviceController.getAllDevices);\r\n router.get('/devices-with-type', deviceController.getDevicesWithTypeName);\r\n+router.get('/brands', deviceController.getAllBrands);\r\n+router.get('/types', deviceController.getAllTypes);\r\n \r\n-// ✅ รองรับอัปโหลดรูป\r\n+// สร้างอุปกรณ์ใหม่ พร้อมอัปโหลดรูป\r\n router.post('/', verifyToken, upload.single('image'), deviceController.addDevice);\r\n+\r\n+// แก้ไขอุปกรณ์ พร้อมอัปโหลดรูป\r\n router.put('/:id', verifyToken, upload.single('image'), deviceController.updateDevice);\r\n \r\n+// ลบอุปกรณ์\r\n router.delete('/:id', verifyToken, deviceController.deleteDevice);\r\n-router.get('/brands', deviceController.getAllBrands);\r\n-router.get('/types', deviceController.getAllTypes);\r\n \r\n+// ✅ เพิ่ม route อัปโหลดรูปเฉพาะ device หลังสร้างแล้ว\r\n+router.post('/:id/upload-image', verifyToken, upload.single('image'), async (req, res) => {\r\n+  const deviceId = req.params.id;\r\n+\r\n+  if (!req.file) {\r\n+    return res.status(400).json({ message: 'ไม่ได้เลือกไฟล์' });\r\n+  }\r\n+\r\n+  const imagePath = `/uploads/${req.file.filename}`;\r\n+\r\n+  try {\r\n+    // update field image ใน DB\r\n+    await deviceController.updateDeviceImage(deviceId, imagePath);\r\n+\r\n+    // ดึงข้อมูล device ล่าสุด\r\n+    const [device] = await deviceController.getDeviceById(deviceId);\r\n+    res.json({ message: 'อัปโหลดรูปสำเร็จ', device: device[0] });\r\n+  } catch (err) {\r\n+    console.error('Error uploading device image:', err);\r\n+    res.status(500).json({ message: 'อัปโหลดรูปไม่สำเร็จ', error: err.message });\r\n+  }\r\n+});\r\n+\r\n module.exports = router;\r\n"
                }
            ],
            "date": 1753930369630,
            "name": "Commit-0",
            "content": "const express = require('express');\r\nconst router = express.Router();\r\nconst deviceController = require('../controllers/deviceController');\r\n\r\n// localhost:4000/api/devices\r\nrouter.get('/devices', deviceController.getAllDevices);\r\n\r\nmodule.exports = router;\r\n"
        }
    ]
}